# DEFINITION_OF_DONE.spec.md

> 本文档定义项目的完成标准（Definition of Done），作为 QA Lead 制定的质量门禁规范。
>
> **适用范围**：所有新功能开发、Bug 修复、重构工作在标记为完成前必须通过以下所有检查项。

---

## Code（代码质量）

### 静态检查

| 检查项                       | 命令/工具            | 验证标准                                   |
| ---------------------------- | -------------------- | ------------------------------------------ |
| 评估代码改动影响范围和正确性 | 无                   | 代码改动不会影响其他功能模块的正确性       |
| TypeScript 类型检查          | `npm run type-check` | 无任何类型错误输出                         |
| ESLint 检查                  | `npm run lint`       | 无任何 error 或 warning（max-warnings: 0） |
| Prettier 格式检查            | `npm run format`     | 无格式化差异                               |

**硬性指标**：

- `npm run type-check` 必须静默成功（无输出或仅输出类型信息）
- `npm run lint` 必须以退出码 0 完成，且无 warning

### TypeScript 类型规范

| 检查项          | 验证标准                                             |
| --------------- | ---------------------------------------------------- |
| 禁用 `any` 类型 | 全项目 `any` 使用数为 0                              |
| 明确类型推断    | 所有函数参数、返回值显式声明类型                     |
| 泛型约束        | 泛型参数使用 `extends` 约束，避免裸泛型              |
| 空值处理        | 使用可选链 `?.` 和空值合并 `??` 替代逻辑与 `&&` 检查 |

**硬性指标**：

```bash
# 禁止 any 类型（ESLint 规则 "@typescript-eslint/no-explicit-any": "error"）
# 禁止未使用变量（noUnusedLocals, noUnusedParameters: true）
```

### 代码注释规范

| 检查项            | 验证标准                                          |
| ----------------- | ------------------------------------------------- |
| 核心业务逻辑注释  | 复杂算法、状态机、消息路由必须有注释说明          |
| 外部 API 集成注释 | Chrome API、PMS API、Pike SDK 调用点需说明用途    |
| 边界条件注释      | 错误处理、降级策略需说明触发条件                  |
| TODO 标记         | 临时方案必须标记 `// TODO: [原因] [预计处理时间]` |
